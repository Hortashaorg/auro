---
description: Rules for creating API endpoints that handle HTMX requests and server-side operations
globs: **/api/**/*.tsx
alwaysApply: false
---
# API Rules

## Route Configuration
- Use `createRoute` with appropriate validation schemas
- Set `partial: true` for HTMX endpoints
- Define clear permission checks
- Implement custom context when needed for data access

## Validation & Error Handling
- Use Valibot schemas for input validation

## Events
- Send events to client with the `createEvents` function.
- Events trigger behaviour client side behaviour on the client.

## Database Operations
- Use transactions for multi-step operations
- Return updated sections after successful operations